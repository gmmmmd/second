"use strict";var e,t,o,n,r=document.querySelector(".overlay"),a="https://academy.directlinedev.com",c=document.querySelector(".main-preloader-js"),s=document.forms.changePasswordForm,u=document.forms.changeDataForm,l=(registerForm.elements.required,registerForm.querySelector(".button-reg-js"),document.querySelector(".user-img-js")),i=document.querySelector(".user-name-js"),m=document.querySelector(".user-surname-js"),d=document.querySelector(".user-email-js"),h=document.querySelector(".user-password-js"),p=document.querySelector(".user-location-js"),f=document.querySelector(".user-age-js"),g={};function y(){l.style.backgroundImage="url(".concat(a+g.photoUrl,")"),i.innerText=g.name,m.innerText=g.surname,d.innerText=g.email,h.innerText=g.password,p.innerText=g.location,f.innerText=g.age}x(c),b({method:"GET",url:"/api/users/".concat(localStorage.getItem("userId"))}).then(function(e){if(e.ok)return e.json();throw new Error("Что-то пошло не так!")}).then(function(e){g=e.data,y(),T(c)}).catch(function(e){alert(e),T(c),location.pathname="/"}),e=localStorage.getItem("token"),t=document.querySelector(".signIn-js"),o=document.querySelector(".register-js"),n=document.querySelector(".toProfile-js"),e?(t.classList.add("common-hidden"),o.classList.add("common-hidden"),n.classList.remove("common-hidden")):(t.classList.remove("common-hidden"),o.classList.remove("common-hidden"),n.classList.add("common-hidden"));var v=document.querySelector(".button_change-pass-js"),S=document.querySelector(".popup_change-pass"),q=document.querySelector(".popup_close-change-pass-js"),j=S.querySelector("input"),k=S.querySelector(".change-password-preloader-js");function I(e){e.preventDefault(),x(k);var o,e=(e=s,e=new FormData(s),o={},e.forEach(function(e,t){o[t]=e}),console.log(o),o);b({method:"PUT",url:"/api/users",body:JSON.stringify(e),headers:{"x-access-token":localStorage.getItem("token"),"Content-Type":"application/json; charset=utf-8"}}).then(function(e){if(e.ok)return e.json();if(401!==e.status&&403!==e.status)throw new Error("Что-то пошло не так!");localStorage.removeItem("token"),localStorage.removeItem("userId"),location.pathname="/"}).then(function(e){alert("Вы успешно поменяли пароль!"),g=e.data,y(),_(S),T(k)}).catch(function(e){alert(e),_(S),T(k)})}v.addEventListener("click",function(){T(k),_(S),j.focus()}),q.addEventListener("click",function(){_(S)}),s.addEventListener("submit",function(e){I(e)});var v=document.querySelector(".button_change-data-js"),L=document.querySelector(".popup_change-data"),q=document.querySelector(".popup_close-change-data-js"),E=L.querySelector("input"),w=L.querySelector(".change-data-preloader-js");function b(e){var t=e.url,o=e.method,n=e.body,e=e.headers;return fetch(a+t+"?v=1.0.0.",{headers:e,method:o,body:n})}function x(e){e.style.display="flex"}function T(e){e.style.display="flex",e.style.display="none"}function _(e){e.classList.toggle("popup_open"),r.classList.toggle("overlay_open")}function D(e){"Escape"===event.key&&(e.classList.remove("popup_open"),r.classList.remove("overlay_open"))}v.addEventListener("click",function(){u.name.value=g.name,u.surname.value=g.surname,u.email.value=g.email,u.location.value=g.location,u.age.value=g.age,T(w),_(L),E.focus()}),q.addEventListener("click",function(){_(L)}),window.addEventListener("keydown",function(){D(S),D(L)}),document.querySelector(".button-signOut-js").addEventListener("click",function(){confirm("выйти из аккаунта?")&&(localStorage.removeItem("token"),localStorage.removeItem("userId"),location.pathname="/")}),u.addEventListener("submit",function(e){e.preventDefault(),x(w),b({method:"PUT",url:"/api/users",body:new FormData(u),headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){if(e.ok)return e.json();if(401!==e.status&&403!==e.status)throw new Error("Что-то пошло не так!");localStorage.removeItem("token"),localStorage.removeItem("userId"),location.pathname="/"}).then(function(e){g=e.data,y(),_(L),T(w)}).catch(function(e){alert(e),T(w)})}),document.querySelector(".button-delete-js").addEventListener("click",function(){confirm("Удалить аккаунт?")&&b({method:"DELETE",url:"/api/users/".concat(localStorage.getItem("userId")),headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){if(e.ok)return e.json();if(401!==e.status&&403!==e.status)throw new Error("Что-то пошло не так!");localStorage.removeItem("token"),localStorage.removeItem("userId"),location.pathname="/"}).then(function(e){alert("Ваш аккаунт был успешно удален"),localStorage.removeItem("token"),localStorage.removeItem("userId"),location.pathname="/"}).catch(function(e){alert(e)})});