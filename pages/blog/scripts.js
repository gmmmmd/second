"use strict";function i(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var e;w(),function(){var e,t=["Январь","Февраль","Март","Апр.","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];e=new Date,console.log("".concat(e.getDate()," число. Месяц:").concat(t[e.getMonth()],". Год:").concat(e.getFullYear()," "));var n,o,s,r,a,c,d="https://academy.directlinedev.com",l=document.querySelector(".filter-preloader-js"),p=document.querySelector(".pagination__button_prev-js"),m=document.querySelector(".pagination__button_next-js");function f(){var e=new URLSearchParams(location.search);return{searchFilter:e.get("searchFilter")||"",tags:e.getAll("tags"),views:e.get("views")||"500-1000",comments:e.getAll("comments"),show:e.get("show")||"5",sort:e.get("sort")||"date",page:+e.get("page")||0}}function h(r){var a=document.querySelector(".post"),c=new XMLHttpRequest,e=new URLSearchParams;e.set("v","1.0.0"),r.tags&&Array.isArray(r.tags)&&r.tags.length&&e.append("tags",JSON.stringify(r.tags));var t={};r.searchFilter&&(t.title=r.searchFilter),r.views&&(t.views={$between:r.views.split("-")}),r.comments.length&&(t.commentsCount={$between:[r.comments[0].split("-")[0],r.comments[r.comments.length-1].split("-")[1]]}),+r.page&&e.set("offset",+r.page*r.show),e.set("filter",JSON.stringify(t)),e.set("limit",r.show),r.sort&&e.set("sort",JSON.stringify([r.sort,"ASC"])),c.open("GET",d+"/api/posts?"+e.toString()),c.send(),a.innerHTML="";var i=document.querySelector(".pagination__page");i.innerHTML="",c.onload=function(){if(200===c.status){var e=JSON.parse(c.response).data,t=JSON.parse(c.response).count,u="";e.forEach(function(e){var t,n,o,s,r,a,c,i,l;u+=(t={title:e.title,text:e.text,src:e.photo.desktopPhotoUrl,commentsCount:e.commentsCount,date:e.date,views:e.views,tags:e.tags},n=t.title,o=t.text,s=t.src,r=t.commentsCount,a=t.date,c=t.views,i=t.tags,e=new Date(a),t=e.getDate()<10?"0"+e.getDate():e.getDate(),a=e.getMonth()<10?"0"+e.getMonth():e.getMonth(),e="".concat(t,".").concat(a,".").concat(e.getFullYear()," "),l="",i.forEach(function(e){l+='<span class="post__tag" style="background-color:'.concat(e.color,'"></span>')}),'\n        <div class="post__item">\n            <img class="article__img" src="'.concat(d).concat(s,'" alt="').concat(n,'" />\n            <div class="post__wrapper">\n                <div class="post__tags">').concat(l,'</div>\n                <div class="post__info">\n                    <span class="post__date">').concat(e,'</span>\n                    <span class="post__views">').concat(c,' views</span>\n                    <span class="post__comments">').concat(r,' Comments</span>\n                </div>\n                <h3 class="post__title">').concat(n,'</h3>\n                <p class="post__description">').concat(o,'</p>\n                <a class="post__link" href="#">Go to this post</a>\n            </div>\n        </div>'))}),a.innerHTML=u;for(var n=Math.ceil(t/r.show),o=0;o<n;o++){var s=function(n){var e=document.createElement("a");e.href="?page="+n,e.innerText=n+1,e.classList.add("pagination__link");var t=f();n===+t.page&&e.classList.add("pagination__link_active");return e.addEventListener("click",function(e){k(l),g(),e.preventDefault();var t=document.querySelectorAll(".pagination__link"),e=new URLSearchParams(location.search);t[f().page].classList.remove("pagination__link_active"),e.set("page",n),t[n].classList.add("pagination__link_active"),history.replaceState(null,document.title,"?"+e.toString()),h(f())}),e}(o);i.insertAdjacentElement("beforeend",s)}g(n),m.addEventListener("click",function(){v(r.page+1)}),p.addEventListener("click",function(){v(f().page-1)}),E(l)}}}function g(e){e?(p.classList.remove("common-visually-hidden"),m.classList.remove("common-visually-hidden")):(p.classList.add("common-visually-hidden"),m.classList.add("common-visually-hidden"))}function v(e){var t=document.querySelectorAll(".pagination__link"),n=new URLSearchParams(location.search),o=f();m.disabled=!1,p.disabled=!1,o.page>=e-1?m.disabled=!0:m.disabled=!1,0===o.page?p.disabled=!0:p.disabled=!1,t[o.page].classList.remove("pagination__link_active"),n.set("page",e),t[e].classList.add("pagination__link_active"),history.replaceState(null,document.title,"?"+n.toString()),h(f())}c=document.forms.filter,E(l),c.addEventListener("submit",function(e){g(),k(l),e.preventDefault();e={page:0};e.searchFilter=c.elements.searchFilter.value,e.tags=i(c.elements.tags).filter(function(e){return e.checked}).map(function(e){return e.value}),e.views=(i(c.elements.views).find(function(e){return e.checked})||{value:null}).value,e.comments=i(c.elements.comments).filter(function(e){return e.checked}).map(function(e){return e.value}),e.show=(i(c.elements.show).find(function(e){return e.checked})||{value:null}).value,e.sort=(i(c.elements.sort).find(function(e){return e.checked})||{value:null}).value,h(e),function(e){var t=new URLSearchParams;t.set("searchFilter",e.searchFilter),e.tags.forEach(function(e){t.append("tags",e)}),e.views&&t.set("views",e.views);e.comments.forEach(function(e){t.append("comments",e)}),e.show&&t.set("show",e.show);e.sort&&t.set("sort",e.sort);e.page?t.set("page",e.page):t.set("page",0);history.replaceState(null,document.title,"?"+t.toString())}(e)}),c.addEventListener("reset",function(){history.replaceState(null,document.title,location.pathname)}),n={method:"GET",url:"".concat(d,"/api/tags"),onload:function(e){var t,n,o=e.xhr;200===o.status&&(e=JSON.parse(o.response).data,t=document.querySelector(".filter__tags"),e.forEach(function(e){e=function(e){var t=e.id,n=e.color,e="";1!==t&&6!==t||(e="checked");return'<li>\n            <label for="color-'.concat(t,'" class="filter__label filter__label_tag">\n                <input id="color-').concat(t,'" class="filter__input" type="checkbox" name="tags" value="').concat(t,'" ').concat(e,'>\n                <span class="filter__input-checkbox filter__input-checkbox_tags filter__input-checkbox_').concat(t,'" style="border-color:').concat(n,'"></span>\n            </label>\n        </li>')}(e);t.insertAdjacentHTML("beforeend",e)}),o=f(),n=o,(e=document.forms.filter).elements.searchFilter.value=n.searchFilter,e.elements.tags.forEach(function(e){e.checked=n.tags.includes(e.value)}),e.elements.views.forEach(function(e){e.checked=n.views===e.value}),e.elements.comments.forEach(function(e){e.checked=n.comments.includes(e.value)}),e.elements.show.forEach(function(e){e.checked=n.show===e.value}),e.elements.sort.forEach(function(e){e.checked=n.sort===e.value}),h(o))}},o=n.method,s=n.url,r=n.onload,(a=new XMLHttpRequest).open(o,s),a.send(),a.onload=function(){return r({xhr:a})}}(),(e=document.querySelector(".button-scroll_js"))&&(e.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("scroll",function(){1500<window.pageYOffset?e.classList.remove("buttonToTop_hidden"):e.classList.add("buttonToTop_hidden")}));var t,n,s,r,a,c,l,u,d,p,m,f,h=document.querySelector(".overlay"),g="https://academy.directlinedev.com";function v(t){t.preventDefault(),k(d);var e=_(p),e={to:e.email,body:JSON.stringify(e)};S({method:"POST",url:"/api/emails",body:JSON.stringify(e),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){if(e.ok)return e.json();throw new Error("Что-то пошло не так")}).then(function(e){alert("Вы успешно отправили письмо!"),b(c),E(d)}).catch(function(e){alert(e),t.target.reset(),E(d)})}function _(e){var e=new FormData(e),n={};return e.forEach(function(e,t){n[t]=e}),console.log(n),n}function y(e,t){e.disabled=!0,t.addEventListener("change",function(){t.checked?e.disabled=!1:e.disabled=!0})}function S(e){var t=e.url,n=e.method,o=e.body,e=e.headers;return fetch(g+t,{headers:e,method:n,body:o})}function w(){var e=localStorage.getItem("token"),t=document.querySelector(".signIn-js"),n=document.querySelector(".register-js"),o=document.querySelector(".toProfile-js");e?(t.classList.add("common-hidden"),n.classList.add("common-hidden"),o.classList.remove("common-hidden")):(t.classList.remove("common-hidden"),n.classList.remove("common-hidden"),o.classList.add("common-hidden"))}function b(e){e.classList.toggle("popup_open"),h.classList.toggle("overlay_open")}function L(e){"Escape"===event.key&&(e.classList.remove("popup_open"),h.classList.remove("overlay_open"))}function k(e){e.style.display="flex"}function E(e){e.style.display="flex",e.style.display="none"}m=document.querySelector(".button_sign-js"),t=document.querySelector(".popup_sign"),f=document.querySelector(".popup_close_sign-js"),n=t.querySelector("input"),s=t.querySelector(".signIn-preloader-js"),r=document.forms.signInForm,m.addEventListener("click",function(){E(s),b(t),n.focus()}),f.addEventListener("click",function(){b(t)}),r.addEventListener("submit",function(e){(e=e).preventDefault(),k(s),e=_(r),S({method:"POST",url:"/api/users/login",body:JSON.stringify(e),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){if(e.ok)return e.json();throw new Error("Что-то пошло не так")}).then(function(e){localStorage.setItem("userId",e.data.userId),localStorage.setItem("token",e.data.token),w(),b(t),setTimeout(function(){E(s),location.pathname="/pages/profile/index.html"},2e3)}).catch(function(e){alert(e),E(s)})}),function(){var e=document.querySelector(".button_register-js"),n=document.querySelector(".popup_register"),t=document.querySelector(".popup_close_register-js"),o=n.querySelector("input"),s=n.querySelector(".register-preloader-js"),r=document.forms.registerForm,a=r.querySelector(".button-reg-js"),c=r.elements.required;signInForm.querySelector(".button-signIn-js");e.addEventListener("click",function(){E(s),b(n),o.focus()}),t.addEventListener("click",function(){b(n)}),y(a,c),r.addEventListener("submit",function(e){!function(t){t.preventDefault(),k(s);var e=_(r);S({method:"POST",url:"/api/users",body:JSON.stringify(e),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){if(e.ok)return e.json();throw new Error("Что-то пошло не так")}).then(function(e){alert("Вы успешно зарегистрировались! Ваш id: ".concat(e.data.id)),b(n),E(s)}).catch(function(e){alert(e),t.target.reset(),E(s)})}(e)})}(),a=document.querySelector(".button_send-js"),c=document.querySelector(".popup_send"),l=document.querySelector(".popup_close_send-js"),u=c.querySelector("input"),d=c.querySelector(".sendMessage-preloader-js"),p=document.forms.sendMessageForm,m=p.querySelector(".button-sendMessage-js"),f=p.elements.required,a.addEventListener("click",function(){E(d),b(c),u.focus()}),l.addEventListener("click",function(){b(c)}),y(m,f),p.addEventListener("submit",function(e){v(e)}),window.addEventListener("keydown",function(){L(popupFormSign),L(popupFormRegister),L(popupFormSend)});